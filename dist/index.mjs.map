{"version":3,"file":"index.mjs","sources":["../../src/sticky/AutoSticky.tsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\n\nexport enum ScrollType {\n  UP,\n  DOWN,\n}\n\nconst AutoSticky = () => {\n  const ref = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    let lastOffsetTop = 0;\n    let type = ScrollType.UP;\n    const options = {\n      offsetTop: 100,\n      offsetBottom: 0,\n    };\n\n    const target = ref.current;\n    const body = window.document.querySelector(\"body\");\n    const block = document.createElement(\"div\");\n    target?.before(block);\n\n    function setBlockHeight(height: number) {\n      block.style.height = `${height}px`;\n    }\n\n    function onScrollDown(el: HTMLElement) {\n      if (!target || lastOffsetTop >= el.scrollTop) return;\n      const { top } = block.getBoundingClientRect();\n      if (top > 0) setBlockHeight(0);\n      else if (top + target.scrollHeight >= el.clientHeight) {\n        setBlockHeight(\n          Math.abs(block.getBoundingClientRect().top) + options.offsetTop\n        );\n      }\n      target.style.top = `${el.clientHeight - target.scrollHeight}px`;\n      target.style.bottom = \"\";\n      type = ScrollType.DOWN;\n    }\n\n    function onScrollUp(el: HTMLElement) {\n      if (!target || lastOffsetTop <= el.scrollTop) return;\n\n      setBlockHeight(target.offsetTop);\n      target.style.bottom =\n        el.clientHeight - target.scrollHeight - options.offsetTop + \"px\";\n      target.style.top = \"\";\n      type = ScrollType.UP;\n    }\n\n    function handleScroll(this: HTMLElement) {\n      if (!target) return;\n      if (target.scrollHeight <= this.clientHeight) {\n        body?.removeEventListener(\"scroll\", handleScroll);\n        return (target.style.top = options.offsetTop + \"px\");\n      }\n\n      switch (type) {\n        case ScrollType.UP:\n          onScrollDown(this);\n          break;\n        case ScrollType.DOWN:\n          onScrollUp(this);\n          break;\n        default:\n          break;\n      }\n      lastOffsetTop = this.scrollTop;\n    }\n    body?.addEventListener(\"scroll\", handleScroll, false);\n    if (target && body) onScrollDown(body);\n\n    return () => {\n      body?.removeEventListener(\"scroll\", handleScroll);\n      block.remove();\n    };\n  }, []);\n  useEffect(() => {\n    const target = ref.current;\n    if (target) {\n      const block = document.createElement(\"div\");\n      target.before(block);\n      return () => {\n        block.remove();\n      };\n    }\n  }, []);\n  return { ref };\n};\n\nexport default AutoSticky;\n"],"names":[],"mappings":";;IAEY,WAGX;AAHD,CAAA,UAAY,UAAU,EAAA;AACpB,IAAA,UAAA,CAAA,UAAA,CAAA,IAAA,CAAA,GAAA,CAAA,CAAA,GAAA,IAAE,CAAA;AACF,IAAA,UAAA,CAAA,UAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAI,CAAA;AACN,CAAC,EAHW,UAAU,KAAV,UAAU,GAGrB,EAAA,CAAA,CAAA,CAAA;AAEK,MAAA,UAAU,GAAG,MAAK;AACtB,IAAA,MAAM,GAAG,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IACzC,SAAS,CAAC,MAAK;QACb,IAAI,aAAa,GAAG,CAAC,CAAC;AACtB,QAAA,IAAI,IAAI,GAAG,UAAU,CAAC,EAAE,CAAC;AACzB,QAAA,MAAM,OAAO,GAAG;AACd,YAAA,SAAS,EAAE,GAAG;AACd,YAAA,YAAY,EAAE,CAAC;SAChB,CAAC;AAEF,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC;QAC3B,MAAM,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACnD,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC5C,QAAA,MAAM,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;QAEtB,SAAS,cAAc,CAAC,MAAc,EAAA;YACpC,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAG,EAAA,MAAM,IAAI,CAAC;SACpC;QAED,SAAS,YAAY,CAAC,EAAe,EAAA;AACnC,YAAA,IAAI,CAAC,MAAM,IAAI,aAAa,IAAI,EAAE,CAAC,SAAS;gBAAE,OAAO;YACrD,MAAM,EAAE,GAAG,EAAE,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC;YAC9C,IAAI,GAAG,GAAG,CAAC;gBAAE,cAAc,CAAC,CAAC,CAAC,CAAC;iBAC1B,IAAI,GAAG,GAAG,MAAM,CAAC,YAAY,IAAI,EAAE,CAAC,YAAY,EAAE;AACrD,gBAAA,cAAc,CACZ,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,SAAS,CAChE,CAAC;AACH,aAAA;AACD,YAAA,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,CAAG,EAAA,EAAE,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,IAAI,CAAC;AAChE,YAAA,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;AACzB,YAAA,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC;SACxB;QAED,SAAS,UAAU,CAAC,EAAe,EAAA;AACjC,YAAA,IAAI,CAAC,MAAM,IAAI,aAAa,IAAI,EAAE,CAAC,SAAS;gBAAE,OAAO;AAErD,YAAA,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACjC,MAAM,CAAC,KAAK,CAAC,MAAM;AACjB,gBAAA,EAAE,CAAC,YAAY,GAAG,MAAM,CAAC,YAAY,GAAG,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC;AACnE,YAAA,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,EAAE,CAAC;AACtB,YAAA,IAAI,GAAG,UAAU,CAAC,EAAE,CAAC;SACtB;AAED,QAAA,SAAS,YAAY,GAAA;AACnB,YAAA,IAAI,CAAC,MAAM;gBAAE,OAAO;AACpB,YAAA,IAAI,MAAM,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,EAAE;AAC5C,gBAAA,IAAI,EAAE,mBAAmB,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;AAClD,gBAAA,QAAQ,MAAM,CAAC,KAAK,CAAC,GAAG,GAAG,OAAO,CAAC,SAAS,GAAG,IAAI,EAAE;AACtD,aAAA;AAED,YAAA,QAAQ,IAAI;gBACV,KAAK,UAAU,CAAC,EAAE;oBAChB,YAAY,CAAC,IAAI,CAAC,CAAC;oBACnB,MAAM;gBACR,KAAK,UAAU,CAAC,IAAI;oBAClB,UAAU,CAAC,IAAI,CAAC,CAAC;oBACjB,MAAM;AAGT,aAAA;AACD,YAAA,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC;SAChC;QACD,IAAI,EAAE,gBAAgB,CAAC,QAAQ,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;QACtD,IAAI,MAAM,IAAI,IAAI;YAAE,YAAY,CAAC,IAAI,CAAC,CAAC;AAEvC,QAAA,OAAO,MAAK;AACV,YAAA,IAAI,EAAE,mBAAmB,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;YAClD,KAAK,CAAC,MAAM,EAAE,CAAC;AACjB,SAAC,CAAC;KACH,EAAE,EAAE,CAAC,CAAC;IACP,SAAS,CAAC,MAAK;AACb,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC;AAC3B,QAAA,IAAI,MAAM,EAAE;YACV,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AAC5C,YAAA,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACrB,YAAA,OAAO,MAAK;gBACV,KAAK,CAAC,MAAM,EAAE,CAAC;AACjB,aAAC,CAAC;AACH,SAAA;KACF,EAAE,EAAE,CAAC,CAAC;IACP,OAAO,EAAE,GAAG,EAAE,CAAC;AACjB;;;;"}